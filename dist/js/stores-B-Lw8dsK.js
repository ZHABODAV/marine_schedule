import{x as e,r as a,c as t}from"./vendor-vue-CBmYbXPK.js";import{v as l,h as n,d as u,f as s,s as o,i as r,r as c,p as i}from"./services-DnyArwnx.js";const d=e("app",()=>{const e=a(!0),t=a("light"),l=a([]),n=a("deepsea"),u=a(!1);function s(e){const a=l.value.findIndex(a=>a.id===e);-1!==a&&l.value.splice(a,1)}return{sidebarOpen:e,theme:t,notifications:l,currentModule:n,loading:u,toggleSidebar:function(){e.value=!e.value},setSidebarOpen:function(a){e.value=a},closeSidebar:function(){e.value=!1},openSidebar:function(){e.value=!0},setCurrentModule:function(e){n.value=e},setLoading:function(e){u.value=e},toggleTheme:function(){t.value="light"===t.value?"dark":"light",document.documentElement.setAttribute("data-theme",t.value)},addNotification:function(e){const a=e.id||Date.now().toString(),t=e.duration||5e3;l.value.push({...e,id:a,timestamp:Date.now()}),t>0&&setTimeout(()=>{s(a)},t)},removeNotification:s,clearNotifications:function(){l.value=[]}}}),v=e("vessel",()=>{const e=a([]),u=a(null),s=a(!1),o=a(null),r=t(()=>e.value.length),c=t(()=>e.value.filter(e=>"active"===e.status)),i=t(()=>e.value.filter(e=>"active"===e.status).length),v=t(()=>{const a=new Set;return e.value.forEach(e=>{e.currentPort&&a.add(e.currentPort)}),a.size}),f=t(()=>{const a={};return e.value.forEach(e=>{const t=e.class||"unknown";a[t]||(a[t]=[]),a[t].push(e)}),a});return{vessels:e,selectedVessel:u,loading:s,error:o,totalVessels:r,activeVessels:c,activeVoyages:i,totalPorts:v,vesselsByType:f,fetchVessels:async function(a){const t=d();s.value=!0,o.value=null;try{e.value=await l.getAll(a)}catch(u){o.value=n(u),t.addNotification({type:"error",message:o.value})}finally{s.value=!1}},fetchVesselById:async function(e){const a=d();s.value=!0,o.value=null;try{return u.value=await l.getById(e),u.value}catch(t){return o.value=n(t),a.addNotification({type:"error",message:o.value}),null}finally{s.value=!1}},createVessel:async function(a){const t=d();s.value=!0,o.value=null;try{const n=await l.create(a);return e.value.push(n),t.addNotification({type:"success",message:`Vessel "${n.name}" created successfully`}),n}catch(u){return o.value=n(u),t.addNotification({type:"error",message:o.value}),null}finally{s.value=!1}},updateVessel:async function(a,t){const u=d();s.value=!0,o.value=null;try{const n=await l.update(a,t),s=e.value.findIndex(e=>e.id===a);return-1!==s&&(e.value[s]=n),u.addNotification({type:"success",message:"Vessel updated successfully"}),n}catch(r){return o.value=n(r),u.addNotification({type:"error",message:o.value}),null}finally{s.value=!1}},deleteVessel:async function(a){const t=d();s.value=!0,o.value=null;try{await l.delete(a);const n=e.value.findIndex(e=>e.id===a);return-1!==n&&e.value.splice(n,1),t.addNotification({type:"success",message:"Vessel deleted successfully"}),!0}catch(u){return o.value=n(u),t.addNotification({type:"error",message:o.value}),!1}finally{s.value=!1}},getVesselSchedule:async function(e,a,t){const u=d();s.value=!0,o.value=null;try{return await l.getSchedule(e,a,t)}catch(r){return o.value=n(r),u.addNotification({type:"error",message:o.value}),[]}finally{s.value=!1}},clearError:function(){o.value=null},clearVessels:function(){e.value=[],u.value=null}}}),f=e("voyage",()=>{const e=a([]),l=a([]),r=a([]),c=a(null),i=a(!1),v=a(null),f=t(()=>e.value.length),y=t(()=>e.value.filter(e=>"planned"===e.status)),p=t(()=>e.value.filter(e=>"active"===e.status)),g=t(()=>e.value.filter(e=>"completed"===e.status));return{voyages:e,templates:l,scenarios:r,selectedVoyage:c,loading:i,error:v,totalVoyages:f,plannedVoyages:y,activeVoyages:p,completedVoyages:g,fetchVoyages:async function(a){const t=d();i.value=!0,v.value=null;try{e.value=await u.getAll(a)}catch(l){v.value=n(l),t.addNotification({type:"error",message:v.value})}finally{i.value=!1}},fetchTemplates:async function(){const e=d();i.value=!0,v.value=null;try{l.value=await s.getAll()}catch(a){v.value=n(a),e.addNotification({type:"error",message:v.value})}finally{i.value=!1}},fetchScenarios:async function(){const e=d();i.value=!0,v.value=null;try{r.value=await o.getAll()}catch(a){v.value=n(a),e.addNotification({type:"error",message:v.value})}finally{i.value=!1}},fetchVoyageById:async function(e){const a=d();i.value=!0,v.value=null;try{return c.value=await u.getById(e),c.value}catch(t){return v.value=n(t),a.addNotification({type:"error",message:v.value}),null}finally{i.value=!1}},createVoyage:async function(a){const t=d();i.value=!0,v.value=null;try{const l=await u.create(a);return e.value.push(l),t.addNotification({type:"success",message:"Voyage created successfully"}),l}catch(l){return v.value=n(l),t.addNotification({type:"error",message:v.value}),null}finally{i.value=!1}},updateVoyage:async function(a,t){const l=d();i.value=!0,v.value=null;try{const n=await u.update(a,t),s=e.value.findIndex(e=>e.id===a);return-1!==s&&(e.value[s]=n),l.addNotification({type:"success",message:"Voyage updated successfully"}),n}catch(s){return v.value=n(s),l.addNotification({type:"error",message:v.value}),null}finally{i.value=!1}},deleteVoyage:async function(a){const t=d();i.value=!0,v.value=null;try{await u.delete(a);const l=e.value.findIndex(e=>e.id===a);return-1!==l&&e.value.splice(l,1),t.addNotification({type:"success",message:"Voyage deleted successfully"}),!0}catch(l){return v.value=n(l),t.addNotification({type:"error",message:v.value}),!1}finally{i.value=!1}},calculateVoyage:async function(e){const a=d();i.value=!0,v.value=null;try{const t=await u.calculate(e);return a.addNotification({type:"success",message:"Voyage calculated successfully"}),t}catch(t){return v.value=n(t),a.addNotification({type:"error",message:v.value}),null}finally{i.value=!1}},optimizeVoyage:async function(a,t){const l=d();i.value=!0,v.value=null;try{const n=await u.optimize(a,t),s=e.value.findIndex(e=>e.id===a);return-1!==s&&(e.value[s]=n),l.addNotification({type:"success",message:"Voyage optimized successfully"}),n}catch(s){return v.value=n(s),l.addNotification({type:"error",message:v.value}),null}finally{i.value=!1}},getVoyageFinancials:async function(e){const a=d();i.value=!0,v.value=null;try{return await u.getFinancials(e)}catch(t){return v.value=n(t),a.addNotification({type:"error",message:v.value}),null}finally{i.value=!1}},generateSchedule:async function(e){const a=d();i.value=!0,v.value=null;try{const t=await u.generateSchedule(e);return a.addNotification({type:"success",message:"Schedule generated successfully"}),t}catch(t){return v.value=n(t),a.addNotification({type:"error",message:v.value}),null}finally{i.value=!1}},clearError:function(){v.value=null},clearData:function(){e.value=[],l.value=[],r.value=[],c.value=null}}}),y=e("cargo",()=>{const e=a([]),l=a([]),u=a(null),s=a(!1),o=a(null),c=t(()=>e.value.length),i=t(()=>e.value.filter(e=>"Pending"===e.status)),v=t(()=>e.value.filter(e=>"Assigned"===e.status)),f=t(()=>e.value.filter(e=>"Completed"===e.status)),y=t(()=>e.value.reduce((e,a)=>e+a.quantity,0)),p=t(()=>e.value.reduce((e,a)=>e+(a.operationalCost||0),0)),g=t(()=>e.value.reduce((e,a)=>e+(a.overheadCost||0),0)),h=t(()=>e.value.reduce((e,a)=>e+(a.otherCost||0),0)),m=t(()=>p.value+g.value+h.value);async function w(){const e=d();s.value=!0,o.value=null;try{const e=await fetch("/api/voyage-templates");if(!e.ok)throw new Error("Failed to fetch templates");const a=await e.json();l.value=a.templates||[]}catch(a){o.value=n(a),e.addNotification({type:"error",message:o.value})}finally{s.value=!1}}return{cargoList:e,templates:l,selectedCargo:u,loading:s,error:o,totalCargo:c,pendingCargo:i,assignedCargo:v,completedCargo:f,totalQuantity:y,totalOperationalCost:p,totalOverheadCost:g,totalOtherCost:h,totalAllCosts:m,fetchCargo:async function(a){const t=d();s.value=!0,o.value=null;try{e.value=await r.getAll(a)}catch(l){o.value=n(l),t.addNotification({type:"error",message:o.value})}finally{s.value=!1}},fetchCargoById:async function(e){const a=d();s.value=!0,o.value=null;try{return u.value=await r.getById(e),u.value}catch(t){return o.value=n(t),a.addNotification({type:"error",message:o.value}),null}finally{s.value=!1}},createCargo:async function(a){const t=d();s.value=!0,o.value=null;try{const l=await r.create(a);return e.value.push(l),t.addNotification({type:"success",message:"Cargo commitment created successfully"}),l}catch(l){return o.value=n(l),t.addNotification({type:"error",message:o.value}),null}finally{s.value=!1}},updateCargo:async function(a,t){const l=d();s.value=!0,o.value=null;try{const n=await r.update(a,t),u=e.value.findIndex(e=>e.id===a);return-1!==u&&(e.value[u]=n),l.addNotification({type:"success",message:"Cargo commitment updated successfully"}),n}catch(u){return o.value=n(u),l.addNotification({type:"error",message:o.value}),null}finally{s.value=!1}},deleteCargo:async function(a){const t=d();s.value=!0,o.value=null;try{await r.delete(a);const l=e.value.findIndex(e=>e.id===a);return-1!==l&&e.value.splice(l,1),t.addNotification({type:"success",message:"Cargo commitment deleted successfully"}),!0}catch(l){return o.value=n(l),t.addNotification({type:"error",message:o.value}),!1}finally{s.value=!1}},getCargoStatistics:async function(e,a,t){const l=d();s.value=!0,o.value=null;try{return await r.getStatistics(e,a,t)}catch(u){return o.value=n(u),l.addNotification({type:"error",message:o.value}),null}finally{s.value=!1}},fetchTemplates:w,createTemplate:async function(e){const a=d();s.value=!0,o.value=null;try{if(!(await fetch("/api/voyage-templates",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw new Error("Failed to create template");return await w(),a.addNotification({type:"success",message:"Template created successfully"}),!0}catch(t){return o.value=n(t),a.addNotification({type:"error",message:o.value}),!1}finally{s.value=!1}},updateTemplate:async function(e,a){const t=d();s.value=!0,o.value=null;try{if(!(await fetch(`/api/voyage-templates/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).ok)throw new Error("Failed to update template");return await w(),t.addNotification({type:"success",message:"Template updated successfully"}),!0}catch(l){return o.value=n(l),t.addNotification({type:"error",message:o.value}),!1}finally{s.value=!1}},deleteTemplate:async function(e){const a=d();s.value=!0,o.value=null;try{if(!(await fetch(`/api/voyage-templates/${e}`,{method:"DELETE"})).ok)throw new Error("Failed to delete template");return l.value=l.value.filter(a=>a.id!==e),a.addNotification({type:"success",message:"Template deleted successfully"}),!0}catch(t){return o.value=n(t),a.addNotification({type:"error",message:o.value}),!1}finally{s.value=!1}},clearError:function(){o.value=null},clearCargo:function(){e.value=[],u.value=null}}}),p=e("route",()=>{const e=a([]),l=a([]),u=a(null),s=a(null),o=a(!1),r=a(null),v=t(()=>e.value.length),f=t(()=>l.value.length),y=t(()=>{const e={};return l.value.forEach(a=>{const t=a.country||"Unknown";e[t]||(e[t]=[]),e[t].push(a)}),e});return{routes:e,ports:l,selectedRoute:u,selectedPort:s,loading:o,error:r,totalRoutes:v,totalPorts:f,portsByCountry:y,fetchRoutes:async function(a){const t=d();o.value=!0,r.value=null;try{e.value=await c.getAll(a)}catch(l){r.value=n(l),t.addNotification({type:"error",message:r.value})}finally{o.value=!1}},fetchPorts:async function(e){const a=d();o.value=!0,r.value=null;try{l.value=await i.getAll(e)}catch(t){r.value=n(t),a.addNotification({type:"error",message:r.value})}finally{o.value=!1}},fetchRouteById:async function(e){const a=d();o.value=!0,r.value=null;try{return u.value=await c.getById(e),u.value}catch(t){return r.value=n(t),a.addNotification({type:"error",message:r.value}),null}finally{o.value=!1}},fetchPortById:async function(e){const a=d();o.value=!0,r.value=null;try{return s.value=await i.getById(e),s.value}catch(t){return r.value=n(t),a.addNotification({type:"error",message:r.value}),null}finally{o.value=!1}},createRoute:async function(a){const t=d();o.value=!0,r.value=null;try{const l=await c.create(a);return e.value.push(l),t.addNotification({type:"success",message:"Route created successfully"}),l}catch(l){return r.value=n(l),t.addNotification({type:"error",message:r.value}),null}finally{o.value=!1}},updateRoute:async function(a,t){const l=d();o.value=!0,r.value=null;try{const n=await c.update(a,t),u=e.value.findIndex(e=>e.id===a);return-1!==u&&(e.value[u]=n),l.addNotification({type:"success",message:"Route updated successfully"}),n}catch(u){return r.value=n(u),l.addNotification({type:"error",message:r.value}),null}finally{o.value=!1}},deleteRoute:async function(a){const t=d();o.value=!0,r.value=null;try{await c.delete(a);const l=e.value.findIndex(e=>e.id===a);return-1!==l&&e.value.splice(l,1),t.addNotification({type:"success",message:"Route deleted successfully"}),!0}catch(l){return r.value=n(l),t.addNotification({type:"error",message:r.value}),!1}finally{o.value=!1}},calculateDistance:async function(e,a,t){const l=d();o.value=!0,r.value=null;try{return await c.calculateDistance(e,a,t)}catch(u){return r.value=n(u),l.addNotification({type:"error",message:r.value}),0}finally{o.value=!1}},getOptimalRoute:async function(e,a,t){const l=d();o.value=!0,r.value=null;try{return await c.getOptimalRoute(e,a,t)}catch(u){return r.value=n(u),l.addNotification({type:"error",message:r.value}),null}finally{o.value=!1}},clearError:function(){r.value=null},clearData:function(){e.value=[],l.value=[],u.value=null,s.value=null}}}),g=e("calendar",()=>{const e=a(new Date),l=a("month"),n=a([]),u=a(!1),s=a(null),o=a({module:"all",vessel:"all",status:"all",searchQuery:""}),r=t(()=>n.value.filter(e=>{if("all"!==o.value.module&&e.module!==o.value.module)return!1;if("all"!==o.value.vessel&&e.vessel!==o.value.vessel)return!1;if("all"!==o.value.status&&e.status!==o.value.status)return!1;if(o.value.searchQuery&&!`${e.title} ${e.route} ${e.vessel}`.toLowerCase().includes(o.value.searchQuery.toLowerCase()))return!1;if(o.value.dateRange){const a=new Date(e.start),t=new Date(e.end),l=o.value.dateRange.start,n=o.value.dateRange.end;if(t<l||a>n)return!1}return!0})),c=t(()=>{const e=r.value;return{totalVoyages:e.length,activeVessels:[...new Set(e.map(e=>e.vessel))].length,totalCargo:e.reduce((e,a)=>e+(a.cargo||0),0),totalCost:e.reduce((e,a)=>e+(a.cost||0),0)}}),i=t(()=>{const e=new Date;return r.value.filter(a=>new Date(a.start)>e).sort((e,a)=>new Date(e.start).getTime()-new Date(a.start).getTime()).slice(0,10)}),d=t(()=>[...new Set(n.value.map(e=>e.vessel))].sort());async function v(){try{const e=await fetch("/api/deepsea/voyages/calculated");if(!e.ok)return[];const a=await e.json();return Object.values(a.calculated_voyages||{}).map(e=>({id:e.voyage_id,title:`${e.vessel_id}: ${e.cargo_type}`,module:"deepsea",vessel:e.vessel_id,start:new Date(e.laycan_start),end:new Date(e.laycan_end),status:p(e.laycan_start,e.laycan_end),cargo:e.qty_mt,cost:e.total_cost_usd,route:`${e.load_port} → ${e.discharge_port}`,details:e}))}catch(e){return[]}}async function f(){try{const e=await fetch("/api/olya/voyages");return e.ok?((await e.json()).voyages||[]).map(e=>({id:e.voyage_id||`OLYA_${Math.random()}`,title:`${e.vessel_name}: ${e.cargo_name||"Cargo"}`,module:"olya",vessel:e.vessel_name,start:new Date(e.start_date||Date.now()),end:new Date(e.end_date||Date.now()),status:"planned",cargo:e.cargo_qty||0,cost:e.total_cost||0,route:`${e.from_port||"Origin"} → ${e.to_port||"Destination"}`,details:e})):[]}catch(e){return[]}}async function y(){try{const e=await fetch("/api/balakovo/voyages");return e.ok?((await e.json()).voyages||[]).map(e=>{const a=e.departure_time||e.load_time||Date.now(),t=e.arrival_time||e.discharge_time||Date.now();return{id:e.voyage_id||`BALAKOVO_${Math.random()}`,title:`${e.vessel_name||"Unknown"}: ${e.cargo||"River Cargo"}`,module:"balakovo",vessel:e.vessel_name||"Unknown Vessel",start:new Date(a),end:new Date(t),status:p(a.toString(),t.toString()),cargo:e.cargo_qty_mt||e.qty_mt||0,cost:e.total_cost||e.voyage_cost||0,route:`${e.from_port||e.load_port||"Origin"} → ${e.to_port||e.discharge_port||"Destination"}`,details:{...e,berth:e.berth_name||e.berth_id,loadingRate:e.loading_rate_mt_day,waitingTime:e.waiting_time_days}}}):[]}catch(e){return[]}}function p(e,a){const t=new Date,l=new Date(e),n=new Date(a);return t<l?"planned":t>n?"completed":"in-progress"}return{currentDate:e,viewType:l,events:n,loading:u,error:s,filters:o,filteredEvents:r,statistics:c,upcomingEvents:i,uniqueVessels:d,fetchEvents:async function(){u.value=!0,s.value=null;try{const[e,a,t]=await Promise.all([v(),f(),y()]);n.value=[...e,...a,...t]}catch(e){s.value=e instanceof Error?e.message:"Failed to load events"}finally{u.value=!1}},setViewType:function(e){l.value=e},setCurrentDate:function(a){e.value=a},navigatePrevious:function(){const a=new Date(e.value);"year"===l.value?a.setFullYear(a.getFullYear()-1):a.setMonth(a.getMonth()-1),e.value=a},navigateNext:function(){const a=new Date(e.value);"year"===l.value?a.setFullYear(a.getFullYear()+1):a.setMonth(a.getMonth()+1),e.value=a},navigateToday:function(){e.value=new Date},updateFilters:function(e){o.value={...o.value,...e}},resetFilters:function(){o.value={module:"all",vessel:"all",status:"all",searchQuery:""}}}}),h=e("filters",()=>{const e=a({module:"all",dateRange:{start:null,end:null},vessels:[],ports:[],routes:[],cargoTypes:[],statuses:[],searchQuery:""}),l=a({module:"all",dateRange:{start:null,end:null},vessels:[],ports:[],routes:[],cargoTypes:[],statuses:[],searchQuery:""}),n=a({module:"all",dateRange:{start:null,end:null},vessels:[],ports:[],routes:[],cargoTypes:[],statuses:[],searchQuery:""}),u=a({module:"all",dateRange:{start:null,end:null},vessels:[],ports:[],routes:[],cargoTypes:[],statuses:[],searchQuery:""}),s=a([{name:"This Month",filters:{dateRange:{start:new Date((new Date).getFullYear(),(new Date).getMonth(),1),end:new Date((new Date).getFullYear(),(new Date).getMonth()+1,0)}}},{name:"This Year",filters:{dateRange:{start:new Date((new Date).getFullYear(),0,1),end:new Date((new Date).getFullYear(),11,31)}}},{name:"Last 30 Days",filters:{dateRange:{start:new Date(Date.now()-2592e6),end:new Date}}}]),o=t(()=>{let a=0;return"all"!==e.value.module&&a++,(e.value.dateRange.start||e.value.dateRange.end)&&a++,e.value.vessels.length>0&&a++,e.value.ports.length>0&&a++,e.value.routes.length>0&&a++,e.value.cargoTypes.length>0&&a++,e.value.statuses.length>0&&a++,e.value.searchQuery&&a++,a}),r=t(()=>{let e=0;return"all"!==l.value.module&&e++,(l.value.dateRange.start||l.value.dateRange.end)&&e++,l.value.vessels.length>0&&e++,l.value.searchQuery&&e++,e}),c=t(()=>{let e=0;return"all"!==n.value.module&&e++,(n.value.dateRange.start||n.value.dateRange.end)&&e++,n.value.vessels.length>0&&e++,e}),i=t(()=>{let e=0;return"all"!==u.value.module&&e++,(u.value.dateRange.start||u.value.dateRange.end)&&e++,u.value.vessels.length>0&&e++,u.value.ports.length>0&&e++,e}),d=t(()=>o.value>0),v=t(()=>r.value>0),f=t(()=>c.value>0),y=t(()=>i.value>0);function p(a){e.value={...e.value,...a}}function g(e){l.value={...l.value,...e}}function h(e){n.value={...n.value,...e}}function m(e){u.value={...u.value,...e}}function w(){e.value={module:"all",dateRange:{start:null,end:null},vessels:[],ports:[],routes:[],cargoTypes:[],statuses:[],searchQuery:""}}function N(){l.value={module:"all",dateRange:{start:null,end:null},vessels:[],ports:[],routes:[],cargoTypes:[],statuses:[],searchQuery:""}}function R(){n.value={module:"all",dateRange:{start:null,end:null},vessels:[],ports:[],routes:[],cargoTypes:[],statuses:[],searchQuery:""}}function F(){u.value={module:"all",dateRange:{start:null,end:null},vessels:[],ports:[],routes:[],cargoTypes:[],statuses:[],searchQuery:""}}function C(){try{localStorage.setItem("filterPresets",JSON.stringify(s.value))}catch(e){}}return function(){try{const e=localStorage.getItem("filterPresets");if(e){const a=JSON.parse(e),t=s.value.map(e=>e.name),l=a.filter(e=>!t.includes(e.name));s.value=[...s.value,...l]}}catch(e){}}(),{voyageFilters:e,scheduleFilters:l,reportFilters:n,calendarFilters:u,presets:s,activeVoyageFiltersCount:o,activeScheduleFiltersCount:r,activeReportFiltersCount:c,activeCalendarFiltersCount:i,hasVoyageFilters:d,hasScheduleFilters:v,hasReportFilters:f,hasCalendarFilters:y,setVoyageFilter:function(a,t){e.value[a]=t},setScheduleFilter:function(e,a){l.value[e]=a},setReportFilter:function(e,a){n.value[e]=a},setCalendarFilter:function(e,a){u.value[e]=a},updateVoyageFilters:p,updateScheduleFilters:g,updateReportFilters:h,updateCalendarFilters:m,resetVoyageFilters:w,resetScheduleFilters:N,resetReportFilters:R,resetCalendarFilters:F,resetAllFilters:function(){w(),N(),R(),F()},applyPreset:function(e,a){const t=s.value.find(a=>a.name===e);if(t)switch(a){case"voyage":p(t.filters);break;case"schedule":g(t.filters);break;case"report":h(t.filters);break;case"calendar":m(t.filters)}},addPreset:function(e,a){const t=s.value.find(a=>a.name===e);t?t.filters=a:s.value.push({name:e,filters:a}),C()},removePreset:function(e){const a=s.value.findIndex(a=>a.name===e);-1!==a&&(s.value.splice(a,1),C())}}}),m=e("schedule",()=>{const e=a(null),l=a([]),u=a([]),s=a(!1),o=a(null),r=a(!1),c=t(()=>l.value.length),i=t(()=>l.value.filter(e=>"archived"!==e.status)),v=t(()=>{const e={};return l.value.forEach(a=>{const t=a.config.year;e[t]||(e[t]=[]),e[t].push(a)}),e}),f=t(()=>e.value?.conflicts||[]),y=t(()=>f.value.filter(e=>"critical"===e.severity));async function p(a,t){const u=d();s.value=!0,o.value=null;try{const n=await fetch(`/api/schedules/${a}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)throw new Error("Failed to update schedule");const s=await n.json(),o=l.value.findIndex(e=>e.id===a);return-1!==o&&(l.value[o]=s),e.value?.id===a&&(e.value=s),u.addNotification({type:"success",message:"Schedule updated successfully"}),s}catch(r){return o.value=n(r),u.addNotification({type:"error",message:o.value}),null}finally{s.value=!1}}return{currentSchedule:e,schedules:l,templates:u,loading:s,error:o,generating:r,totalSchedules:c,activeSchedules:i,schedulesByYear:v,conflicts:f,criticalConflicts:y,fetchSchedules:async function(e){const a=d();s.value=!0,o.value=null;try{const a=e?{year:e}:{},t=await fetch(`/api/schedules?${new URLSearchParams(a)}`);if(!t.ok)throw new Error("Failed to fetch schedules");l.value=await t.json()}catch(t){o.value=n(t),a.addNotification({type:"error",message:o.value})}finally{s.value=!1}},fetchScheduleById:async function(a){const t=d();s.value=!0,o.value=null;try{const t=await fetch(`/api/schedules/${a}`);if(!t.ok)throw new Error("Failed to fetch schedule");return e.value=await t.json(),e.value}catch(l){return o.value=n(l),t.addNotification({type:"error",message:o.value}),null}finally{s.value=!1}},generateSchedule:async function(a){const t=d();r.value=!0,o.value=null;try{const n=await fetch("/api/schedule/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!n.ok)throw new Error("Failed to generate schedule");const u=await n.json();return l.value.unshift(u),e.value=u,t.addNotification({type:"success",message:"Schedule generated successfully"}),u}catch(u){return o.value=n(u),t.addNotification({type:"error",message:o.value}),null}finally{r.value=!1}},updateSchedule:p,finalizeSchedule:async function(e){return p(e,{status:"finalized"})},archiveSchedule:async function(e){return p(e,{status:"archived"})},deleteSchedule:async function(a){const t=d();s.value=!0,o.value=null;try{if(!(await fetch(`/api/schedules/${a}`,{method:"DELETE"})).ok)throw new Error("Failed to delete schedule");const n=l.value.findIndex(e=>e.id===a);return-1!==n&&l.value.splice(n,1),e.value?.id===a&&(e.value=null),t.addNotification({type:"success",message:"Schedule deleted successfully"}),!0}catch(u){return o.value=n(u),t.addNotification({type:"error",message:o.value}),!1}finally{s.value=!1}},fetchTemplates:async function(e){const a=d();s.value=!0,o.value=null;try{const a=e?{module:e}:{},t=await fetch(`/api/schedules/templates?${new URLSearchParams(a)}`);if(!t.ok)throw new Error("Failed to fetch templates");u.value=await t.json()}catch(t){o.value=n(t),a.addNotification({type:"error",message:o.value})}finally{s.value=!1}},resolveConflict:async function(a,t,l){const u=d();s.value=!0,o.value=null;try{const n=await fetch(`/api/schedules/${a}/conflicts/${t}/resolve`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({resolution:l})});if(!n.ok)throw new Error("Failed to resolve conflict");const s=await n.json();return e.value?.id===a&&(e.value=s),u.addNotification({type:"success",message:"Conflict resolved successfully"}),s}catch(r){return o.value=n(r),u.addNotification({type:"error",message:o.value}),null}finally{s.value=!1}},exportToPDF:async function(e){const a=d();s.value=!0,o.value=null;try{const t=await fetch(`/api/schedules/${e}/export/pdf`);if(!t.ok)throw new Error("Failed to export PDF");const n=await t.blob(),u=window.URL.createObjectURL(n),s=document.createElement("a");s.href=u;const o=l.value.find(a=>a.id===e);return s.download=`schedule-${o?.config.year||"export"}.pdf`,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(u),a.addNotification({type:"success",message:"PDF exported successfully"}),!0}catch(t){return o.value=n(t),a.addNotification({type:"error",message:o.value}),!1}finally{s.value=!1}},exportToExcel:async function(e){const a=d();s.value=!0,o.value=null;try{const t=await fetch(`/api/schedules/${e}/export/excel`);if(!t.ok)throw new Error("Failed to export Excel");const n=await t.blob(),u=window.URL.createObjectURL(n),s=document.createElement("a");s.href=u;const o=l.value.find(a=>a.id===e);return s.download=`schedule-${o?.config.year||"export"}.xlsx`,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(u),a.addNotification({type:"success",message:"Excel exported successfully"}),!0}catch(t){return o.value=n(t),a.addNotification({type:"error",message:o.value}),!1}finally{s.value=!1}},saveScenario:async function(a,t,u){const r=d();s.value=!0,o.value=null;try{const n=await fetch(`/api/schedules/${a}/scenario`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,description:u})});if(!n.ok)throw new Error("Failed to save scenario");const s=await n.json(),o=l.value.findIndex(e=>e.id===a);return-1!==o&&(l.value[o]=s),e.value?.id===a&&(e.value=s),r.addNotification({type:"success",message:`Scenario "${t}" saved successfully`}),s}catch(c){return o.value=n(c),r.addNotification({type:"error",message:o.value}),null}finally{s.value=!1}},clearError:function(){o.value=null},clearData:function(){l.value=[],u.value=[],e.value=null}}}),w=e("reports",()=>{const e=a([]),l=a([]),u=a(!1),s=a(null),o=t(()=>e.value.filter(e=>"pending"===e.status||"generating"===e.status)),r=t(()=>e.value.filter(e=>"completed"===e.status)),c=t(()=>e.value.filter(e=>"failed"===e.status)),i=t(()=>[...l.value].sort((e,a)=>new Date(a.createdAt).getTime()-new Date(e.createdAt).getTime()).slice(0,10));async function v(a){try{const t=await fetch(`/api/reports/${a}/status`);if(!t.ok)throw new Error("Failed to fetch report status");const l=await t.json(),n=e.value.findIndex(e=>e.id===a);return-1!==n&&(e.value[n]=l),l}catch(t){return s.value=n(t),null}}function f(a){const t=e.value.findIndex(e=>e.id===a);if(-1!==t){const a=e.value[t];a&&(l.value.unshift(a),e.value.splice(t,1))}}return{activeReports:e,history:l,loading:u,error:s,pendingReports:o,completedReports:r,failedReports:c,recentReports:i,generateReport:async function(a){const t=d();u.value=!0,s.value=null;try{const l=await fetch("/api/reports/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!l.ok)throw new Error("Failed to initiate report generation");const n=await l.json();return e.value.push(n),t.addNotification({type:"info",message:"Report generation started"}),async function(e){const a=d();let t=0;const l=async()=>{if(t>=60)return void a.addNotification({type:"warning",message:"Report generation taking longer than expected"});const n=await v(e);n&&("completed"===n.status?(a.addNotification({type:"success",message:"Report generated successfully"}),setTimeout(()=>f(e),3e4)):"failed"===n.status?(a.addNotification({type:"error",message:n.error||"Report generation failed"}),setTimeout(()=>f(e),1e4)):(t++,setTimeout(l,5e3)))};l()}(n.id),n}catch(l){return s.value=n(l),t.addNotification({type:"error",message:s.value}),null}finally{u.value=!1}},fetchReportStatus:v,downloadReport:async function(e){const a=d();u.value=!0,s.value=null;try{const t=await fetch(`/api/reports/${e}/download`);if(!t.ok)throw new Error("Failed to download report");const l=await t.blob(),n=window.URL.createObjectURL(l),u=document.createElement("a");u.href=n;const s=t.headers.get("Content-Disposition"),o=s?.match(/filename="?(.+)"?/i),r=o&&o[1]||`report_${e}.pdf`;u.download=r,document.body.appendChild(u),u.click(),window.URL.revokeObjectURL(n),document.body.removeChild(u),a.addNotification({type:"success",message:"Report downloaded successfully"})}catch(t){s.value=n(t),a.addNotification({type:"error",message:s.value})}finally{u.value=!1}},fetchReportHistory:async function(){const e=d();u.value=!0,s.value=null;try{const e=await fetch("/api/reports/history");if(!e.ok)throw new Error("Failed to fetch report history");l.value=await e.json()}catch(a){s.value=n(a),e.addNotification({type:"error",message:s.value})}finally{u.value=!1}},deleteReport:async function(a){const t=d();u.value=!0,s.value=null;try{if(!(await fetch(`/api/reports/${a}`,{method:"DELETE"})).ok)throw new Error("Failed to delete report");return e.value=e.value.filter(e=>e.id!==a),l.value=l.value.filter(e=>e.id!==a),t.addNotification({type:"success",message:"Report deleted successfully"}),!0}catch(o){return s.value=n(o),t.addNotification({type:"error",message:s.value}),!1}finally{u.value=!1}},moveToHistory:f,clearError:function(){s.value=null},clearActiveReports:function(){e.value.forEach(e=>{l.value.find(a=>a.id===e.id)||l.value.unshift(e)}),e.value=[]}}});export{y as a,v as b,p as c,h as d,g as e,w as f,m as g,d as h,f as u};
//# sourceMappingURL=stores-B-Lw8dsK.js.map
