# Полное руководство по системе планирования судов (Vessel Scheduler Enhanced)

**Версия**: 3.0.0

## 1. Обзор

**Vessel Scheduler Enhanced** — это комплексная система планирования морской логистики, позволяющая управлять операциями судов, грузовыми обязательствами, планированием рейсов и оптимизацией сети. Эта расширенная версия включает функции для работы с несколькими модулями (Deep Sea, Балаково, Оля), автоматического планирования, построения рейсов, сравнительной аналитики и визуализации сети.

---

## 2. Ключевые возможности

### 1. Единые глобальные фильтры

Фильтрация данных во всех модулях по:

* Модулю (Deep Sea, Балаково, Оля)
* Диапазону дат (начало/конец)
* Типу продукта/товара
* Порту (погрузки/выгрузки)
* Судну
* Типам операций (Погрузка, Выгрузка, Транзит, Балласт, Канал, Бункер, Ожидание)

### 2. Многомодульная архитектура

* **Модуль Deep Sea**: Международные морские грузоперевозки.
* **Модуль Балаково**: Региональные речные операции (терминал).
* **Модуль Оля**: Координация операций в Каспийском море и на реке.

Каждый модуль имеет свои собственные мастер-данные и планы.

### 3. Импорт данных (CSV)

Поддержка импорта данных через CSV файлы (разделитель `;`):

* **Мастер-данные**: Порты, Маршруты, Суда, Типы грузов.
* **Данные планирования**: Обязательства по грузам, ЖД отгрузки, Движение грузов, Этапы рейсов.

### 4. Автоматическое сохранение

Все данные автоматически сохраняются в браузере (localStorage) каждые 30 секунд.

### 5. Генератор авто-расписания

Преобразует обязательства по грузам в полные расписания рейсов:

1. Назначает суда на грузы.
2. Генерирует этапы рейса (балласт → погрузка → транзит → выгрузка).
3. Рассчитывает длительность на основе норм портов и скорости судов.
4. Учитывает временные окна (laycan).

### 6. Интерактивный конструктор рейсов

* Добавление этапов вручную.
* Типы этапов: Балласт, Погрузка, Транзит, Выгрузка, Канал, Бункер, Ожидание.
* Валидация последовательности этапов в реальном времени.
* Сохранение проверенных рейсов как шаблонов.

### 7. Сравнительная аналитика

* Сравнение нескольких рейсов или сценариев.
* KPI: Дистанция, Длительность, Выручка, Затраты, Прибыль, TCE (Тайм-чартерный эквивалент).
* Экспорт результатов в Excel.

### 8. Накопление грузов в порту

Отслеживание ежедневных уровней запасов:

* Входящий поток (ЖД).
* Исходящий поток (Море).
* Прогноз на 60 дней.

### 9. Визуализация сети

Интерактивная карта портов, заводов и маршрутов (морских и железнодорожных).

### 10. Расширенный экспорт

Экспорт в Excel: График Ганта, Обзор флота, Сводка рейсов, Сравнение сценариев, Финансовый анализ и др.

---

## 3. Установка и Запуск

### Требования

* **Python 3.8** или выше.
* Современный веб-браузер (Chrome, Firefox, Edge).

### Быстрый запуск (Windows)

1. Откройте папку с программой.
2. Запустите файл **`install.bat`** (только при первом запуске) для установки зависимостей.
3. Запустите файл **`start.bat`**. Это запустит сервер и откроет браузер.

### Ручной запуск (через командную строку)

1. Установите зависимости:

    ```bash
    pip install -r requirements.txt
    ```

2. Запустите сервер:

    ```bash
    python api_server.py
    ```

3. Откройте в браузере: `http://localhost:5000/vessel_scheduler_complete.html`

---

## 4. Руководство по веб-интерфейсу

### Панель (Dashboard)

Отображает ключевые метрики: Активные суда, Ожидающие грузы, Общая дистанция, Загрузка флота. Метрики обновляются при изменении глобальных фильтров.

### Вкладки данных (Суда, Грузы, Маршруты)

Просмотр и управление справочными данными. Можно добавлять и редактировать записи через формы.

### Расписание (Schedule)

* Нажмите **"Сгенерировать расписание"** для создания графика Ганта на 30 дней.
* Используйте чекбоксы типов операций для фильтрации отображения.
* Экспорт графика в Excel.

### Конструктор рейсов (Voyage Builder)

1. Нажмите **"Добавить этап"**.
2. Заполните детали (тип, откуда, куда, дистанция).
3. Нажмите **"Проверить"** для валидации.
4. Нажмите **"Сохранить шаблон"** для использования в будущем.

### Сравнение (Comparison)

1. Выберите рейсы или сценарии галочками.
2. Нажмите **"Сравнить выбранные"**.
3. Просмотрите таблицу сравнения KPI.

### Склады портов (Port Stock)

1. Выберите порт из списка.
2. Нажмите **"Рассчитать"**.
3. Просмотрите график накопления груза.

### План продаж (Sales Plan)

Калькулятор показывает требуемые отгрузки, предлагаемое количество рейсов и дефицит вместимости.

### Сеть (Network)

Визуализация логистической сети. Нажмите **"Сгенерировать сеть"** для построения графа.

### Отчеты (Reports)

Центр экспорта и импорта данных.

* **Экспорт**: Скачивание различных отчетов в Excel.
* **Импорт**: Загрузка CSV файлов (Порты, Маршруты, Суда, Грузы и др.).

---

## 5. Форматы данных (CSV)

Все файлы должны быть в кодировке **UTF-8** с разделителем **точка с запятой (;)**.

### Ports.csv (Порты)

```csv
port_id;port_name;country;basin;unlocode;latitude;longitude;can_handle_liquid;can_handle_dry;avg_loading_rate_tph;avg_discharge_rate_tph;typical_waiting_hours;congestion_level
P001;Houston;USA;Gulf of Mexico;USHOU;29.7604;-95.3698;yes;yes;400;500;12;Low
```

### Routes.csv (Маршруты)

```csv
route_id;route_name;port_start_id;port_end_id;distance_nm;typical_duration_days;canal_transit;canal_name;eca_pct;waypoints;typical_weather_risk
R001;Houston-Rotterdam;Houston;Rotterdam;4800;14.5;no;;25;Gibraltar;Low
```

### Vessels.csv (Суда)

```csv
vessel_id;vessel_name;vessel_class;type;dwt_mt;capacity_mt;speed_kn;tc_daily_hire_usd;contract_type
V001;Atlantic Star;Handysize;Dry Bulk;35000;33000;14.0;15000;Time Charter
```

### CargoCommitments.csv (Обязательства по грузам)

```csv
commitment_id;product_name;qty_mt;load_port_id;discharge_port_id;load_date_window_start;load_date_window_end;delivery_deadline;status
C001;Grain;50000;Houston;Rotterdam;2025-01-15;2025-01-20;2025-02-15;Pending
```

---

## 6. Конфигурация

Файл `config.yaml` позволяет настроить параметры системы:

```yaml
deepsea:
  default_speed_kts: 14          # Скорость судна по умолчанию (узлы)
  loading_rate_mt_per_day: 5000  # Норма погрузки (тонн/день)

olya:
  default_speed_kph: 15          # Скорость речных судов (км/ч)
  num_berths: 2                  # Количество причалов

balakovo:
  default_load_rate: 2500        # Норма погрузки (тонн/день)
  berth_capacity_mt: 10000       # Вместимость причала
```

---

## 7. Устранение неполадок

### Данные не сохраняются

* Проверьте, не переполнено ли хранилище браузера (localStorage).
* Убедитесь, что JavaScript включен.

### Ошибка импорта

* Убедитесь, что CSV файл использует разделитель `;`.
* Проверьте кодировку файла (должна быть UTF-8).
* Проверьте формат дат (YYYY-MM-DD).

### График Ганта пустой

* Сначала импортируйте суда и грузы.
* Нажмите "Сгенерировать расписание".
* Убедитесь, что у судов статус 'Active'.

### Сервер не запускается

* Проверьте, установлен ли Python.
* Убедитесь, что установлены все зависимости (`pip install -r requirements.txt`).
* Проверьте, не занят ли порт 5000 другим приложением.

---

## 8. Контакты и поддержка

Для вопросов и предложений обращайтесь к команде морской логистики.

*Приятного планирования!* 
